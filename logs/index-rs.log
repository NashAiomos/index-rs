[2025-04-25 14:58:13] [INFO] - =================================
[2025-04-25 14:58:13] [INFO] - ===========  服务启动  ===========
[2025-04-25 14:58:13] [INFO] - =================================
[2025-04-25 14:58:13] [INFO] - 正在启动区块链索引服务...
[2025-04-25 14:58:13] [INFO] - 启动索引服务...
[2025-04-25 14:58:13] [INFO] - 检测到重置参数 --reset
[2025-04-25 14:58:13] [INFO] - 已连接到MongoDB
[2025-04-25 14:58:13] [INFO] - IC Agent初始化完成，连接到: https://icp0.io
[2025-04-25 14:58:13] [INFO] - 使用配置文件中指定的代币小数位: 6
[2025-04-25 14:58:13] [INFO] - 代币小数位设置为: 6
[2025-04-25 14:58:13] [INFO] - 创建或确认数据库索引...
[2025-04-25 14:58:13] [INFO] - 交易索引创建成功
[2025-04-25 14:58:13] [INFO] - 账户索引创建成功
[2025-04-25 14:58:13] [INFO] - 余额索引创建成功
[2025-04-25 14:58:13] [INFO] - 同步状态索引创建成功
[2025-04-25 14:58:13] [INFO] - 开始执行数据库重置和重新同步操作...
[2025-04-25 14:58:13] [INFO] - 开始重置数据库并重新同步所有交易数据...
[2025-04-25 14:58:13] [INFO] - 清空交易集合...
[2025-04-25 14:58:14] [INFO] - 已清除 22579 条交易记录
[2025-04-25 14:58:14] [INFO] - 清空账户-交易关系集合...
[2025-04-25 14:58:14] [INFO] - 已清除 21662 条账户记录
[2025-04-25 14:58:14] [INFO] - 清空余额集合...
[2025-04-25 14:58:14] [INFO] - 已清除 21663 条余额记录
[2025-04-25 14:58:14] [INFO] - 清空同步状态集合...
[2025-04-25 14:58:14] [INFO] - 已清除 1 条同步状态记录
[2025-04-25 14:58:14] [INFO] - 设置为全量同步模式
[2025-04-25 14:58:14] [INFO] - 同步状态已更新: 索引 0, 时间戳 0, 模式 full
[2025-04-25 14:58:14] [INFO] - 重新创建索引...
[2025-04-25 14:58:14] [INFO] - 创建或确认数据库索引...
[2025-04-25 14:58:14] [INFO] - 交易索引创建成功
[2025-04-25 14:58:14] [INFO] - 账户索引创建成功
[2025-04-25 14:58:14] [INFO] - 余额索引创建成功
[2025-04-25 14:58:14] [INFO] - 同步状态索引创建成功
[2025-04-25 14:58:14] [INFO] - 
第一阶段：同步所有交易数据到数据库...
[2025-04-25 14:58:14] [INFO] - 
同步归档交易...
[2025-04-25 14:58:14] [INFO] - 获取归档信息...
[2025-04-25 14:58:14] [INFO] - 获取归档信息...
[2025-04-25 14:58:15] [INFO] - 发现 1 个归档 canister，将依次同步
[2025-04-25 14:58:15] [INFO] - 处理归档 1/1: canister_id=b4lia-7yaaa-aaaaj-az7uq-cai
[2025-04-25 14:58:15] [INFO] - 成功获取到归档交易批次：0-1999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:58:16] [INFO] - 成功获取到归档交易批次：0-1999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:58:22] [INFO] - 成功获取到归档交易批次：2000-3999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:58:30] [INFO] - 成功获取到归档交易批次：4000-5999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:58:38] [INFO] - 成功获取到归档交易批次：6000-7999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:58:47] [INFO] - 成功获取到归档交易批次：8000-9999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:58:58] [INFO] - 成功获取到归档交易批次：10000-11999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:59:08] [INFO] - 成功获取到归档交易批次：12000-13999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:59:20] [INFO] - 成功获取到归档交易批次：14000-15999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:59:33] [INFO] - 成功获取到归档交易批次：16000-17999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:59:46] [INFO] - 成功获取到归档交易批次：18000-19999，使用SimpleTransactionRange解码，已保存到数据库
[2025-04-25 14:59:59] [INFO] - 归档同步完成，共同步 20000 笔归档交易
[2025-04-25 14:59:59] [INFO] - 
同步ledger交易...
[2025-04-25 14:59:59] [INFO] - 区块链初始索引默认为0
[2025-04-25 14:59:59] [INFO] - 获取到区块链初始索引: 0
[2025-04-25 14:59:59] [INFO] - 数据库中最新的交易索引: 19999
[2025-04-25 14:59:59] [INFO] - 从索引 20000 开始同步新交易
[2025-04-25 15:00:00] [INFO] - 成功获取到主账本交易批次：20000-21999，使用LedgerGetTransactionsResult解码，已保存到数据库
[2025-04-25 15:00:00] [INFO] - 获取到 2000 笔交易
[2025-04-25 15:00:12] [INFO] - 成功保存 2000 笔交易，失败 0 笔
[2025-04-25 15:00:12] [INFO] - 设置为增量同步模式，最新索引: 21999
[2025-04-25 15:00:12] [INFO] - 同步状态已更新: 索引 21999, 时间戳 1745419555207720117, 模式 incremental
[2025-04-25 15:00:12] [INFO] - 已更新同步状态索引: 19999 -> 21999
[2025-04-25 15:00:13] [INFO] - 成功获取到主账本交易批次：22000-22605，使用LedgerGetTransactionsResult解码，已保存到数据库
[2025-04-25 15:00:13] [INFO] - 获取到 606 笔交易
[2025-04-25 15:00:14] [INFO] - 成功保存 606 笔交易，失败 0 笔
[2025-04-25 15:00:14] [INFO] - 设置为增量同步模式，最新索引: 22605
[2025-04-25 15:00:14] [INFO] - 同步状态已更新: 索引 22605, 时间戳 1745563559549605913, 模式 incremental
[2025-04-25 15:00:14] [INFO] - 已更新同步状态索引: 21999 -> 22605
[2025-04-25 15:00:21] [INFO] - 连续 3 次获取空结果，认为已达到链上最新状态
[2025-04-25 15:00:21] [INFO] - 设置为增量同步模式，最新索引: 22605
[2025-04-25 15:00:21] [INFO] - 同步状态已更新: 索引 22605, 时间戳 1745563559549605913, 模式 incremental
[2025-04-25 15:00:21] [INFO] - 同步状态已更新至最新索引: 22605 (共同步 2606 笔新交易)
[2025-04-25 15:00:21] [INFO] - 交易同步完成，当前索引: 23205, 共同步 2606 笔新交易
[2025-04-25 15:00:21] [INFO] - 
第二阶段：根据账户信息计算余额...
[2025-04-25 15:00:21] [INFO] - 开始使用新算法计算所有账户余额...
[2025-04-25 15:00:21] [INFO] - 开始计算所有账户余额...
[2025-04-25 15:00:21] [INFO] - 已清除 1 条余额记录
[2025-04-25 15:01:06] [INFO] - 余额计算完成: 成功 21662 个账户, 失败 0 个账户
[2025-04-25 15:01:06] [INFO] - 余额计算完成: 成功处理 21662 个账户, 失败 0 个账户
[2025-04-25 15:01:06] [INFO] - 所有账户的余额计算已完成
[2025-04-25 15:01:06] [INFO] - 重置完成：设置增量同步模式，最新索引: 22605, 时间戳: 1745563559549605913
[2025-04-25 15:01:06] [INFO] - 设置为增量同步模式，最新索引: 22605
[2025-04-25 15:01:06] [INFO] - 同步状态已更新: 索引 22605, 时间戳 1745563559549605913, 模式 incremental
[2025-04-25 15:01:06] [INFO] - 数据库重置和交易同步完成，所有账户余额已根据交易记录重新计算！
[2025-04-25 15:01:06] [INFO] - 下次运行将从索引 22606 开始增量同步
[2025-04-25 15:01:06] [INFO] - 数据库重置和重新同步成功完成！
[2025-04-25 15:10:46] [INFO] - =================================
[2025-04-25 15:10:46] [INFO] - ===========  服务启动  ===========
[2025-04-25 15:10:46] [INFO] - =================================
[2025-04-25 15:10:46] [INFO] - 正在启动区块链索引服务...
[2025-04-25 15:10:46] [INFO] - 启动索引服务...
[2025-04-25 15:10:46] [INFO] - 已连接到MongoDB
[2025-04-25 15:10:46] [INFO] - IC Agent初始化完成，连接到: https://icp0.io
[2025-04-25 15:10:46] [INFO] - 使用配置文件中指定的代币小数位: 6
[2025-04-25 15:10:46] [INFO] - 代币小数位设置为: 6
[2025-04-25 15:10:46] [INFO] - 创建或确认数据库索引...
[2025-04-25 15:10:46] [INFO] - 交易索引创建成功
[2025-04-25 15:10:46] [INFO] - 账户索引创建成功
[2025-04-25 15:10:46] [INFO] - 余额索引创建成功
[2025-04-25 15:10:46] [INFO] - 同步状态索引创建成功
[2025-04-25 15:10:46] [INFO] - 检测到有效的同步状态，上次同步索引：22605，上次同步时间：2025-04-25 07:01:06，将继续增量同步
[2025-04-25 15:10:46] [INFO] - 从断点继续同步，验证同步状态的完整性...
[2025-04-25 15:10:46] [INFO] - 同步状态与数据库记录一致，索引: 22605
[2025-04-25 15:10:46] [INFO] - 跳过初始同步，直接进入增量同步模式
[2025-04-25 15:10:46] [INFO] - 配置中启用了API服务器，即将启动...
[2025-04-25 15:10:46] [INFO] - API服务器已在后台启动，端口: 3000
[2025-04-25 15:10:46] [INFO] - 开始实时监控新交易
[2025-04-25 15:10:46] [INFO] - 启动API服务器，端口: 3000
[2025-04-25 15:10:46] [INFO] - Server::run; addr=0.0.0.0:3000
[2025-04-25 15:10:46] [INFO] - listening on http://0.0.0.0:3000
[2025-04-25 15:10:46] [INFO] - 数据库中最新的交易索引: 22605
[2025-04-25 15:10:46] [INFO] - 从索引 22606 开始同步新交易
[2025-04-25 15:10:54] [INFO] - 连续 3 次获取空结果，认为已达到链上最新状态
[2025-04-25 15:10:54] [INFO] - 无新交易，保持同步状态在索引: 22605
[2025-04-25 15:10:54] [INFO] - 交易同步完成，当前索引: 23205, 共同步 0 笔新交易
[2025-04-25 15:10:54] [INFO] - 数据库中最新的交易索引: 22605
[2025-04-25 15:10:54] [INFO] - 从索引 22606 开始同步新交易
[2025-04-25 15:11:01] [INFO] - 连续 3 次获取空结果，认为已达到链上最新状态
[2025-04-25 15:11:01] [INFO] - 无新交易，保持同步状态在索引: 22605
[2025-04-25 15:11:01] [INFO] - 交易同步完成，当前索引: 23205, 共同步 0 笔新交易
[2025-04-25 15:11:01] [INFO] - 数据库中最新的交易索引: 22605
[2025-04-25 15:11:01] [INFO] - 从索引 22606 开始同步新交易
[2025-04-25 15:11:07] [INFO] - 连续 3 次获取空结果，认为已达到链上最新状态
[2025-04-25 15:11:07] [INFO] - 无新交易，保持同步状态在索引: 22605
[2025-04-25 15:11:07] [INFO] - 交易同步完成，当前索引: 23205, 共同步 0 笔新交易
[2025-04-25 15:11:07] [INFO] - 数据库中最新的交易索引: 22605
[2025-04-25 15:11:07] [INFO] - 从索引 22606 开始同步新交易
[2025-04-25 15:11:14] [INFO] - 连续 3 次获取空结果，认为已达到链上最新状态
[2025-04-25 15:11:14] [INFO] - 无新交易，保持同步状态在索引: 22605
[2025-04-25 15:11:14] [INFO] - 交易同步完成，当前索引: 23205, 共同步 0 笔新交易
[2025-04-25 15:11:14] [INFO] - 数据库中最新的交易索引: 22605
[2025-04-25 15:11:14] [INFO] - 从索引 22606 开始同步新交易
[2025-04-25 15:11:21] [INFO] - 连续 3 次获取空结果，认为已达到链上最新状态
[2025-04-25 15:11:21] [INFO] - 无新交易，保持同步状态在索引: 22605
[2025-04-25 15:11:21] [INFO] - 交易同步完成，当前索引: 23205, 共同步 0 笔新交易
[2025-04-25 15:11:21] [INFO] - 数据库中最新的交易索引: 22605
[2025-04-25 15:11:21] [INFO] - 从索引 22606 开始同步新交易
